#!/usr/bin/env sh

#-------------------------------------------------
# render-user-nix
#-------------------------------------------------
# render user specific nix files for NIX and home-manager

render_user_nix() {
  local file="$1"
  local dest="$2"
  if [ -f "$file" ]; then
    local tmp="/tmp/$(basename "$1")"
    # substitutes sh experssions
    (
      echo "cat <<EOF"
      cat "$file"
      echo EOF
    ) | sh >"$tmp"
    cp "$tmp" "$dest"
  fi
}

CONFIG_DIR=${XDG_CONFIG_HOME:-$HOME/.config/nix}

render_user_nix \
  "$CONFIG_DIR/user.nix.tpl" \
  "$CONFIG_DIR/user.nix"

# no need to keep the function
unset render_user_nix
